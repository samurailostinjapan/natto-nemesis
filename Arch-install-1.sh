#!/bin/bash
#set -e
###############################################################################
# Title	:	ArchLinux Install Script
# Author: 	Natto
###############################################################################
#
#   DO NOT JUST RUN THIS. EXAMINE AND JUDGE. RUN AT YOUR OWN RISK.
#
###############################################################################

echo
echo "###############################################################################"
echo "Update the System Clock"
echo "###############################################################################"
echo
		timedatectl set-ntp true
echo
echo "###############################################################################"
echo "Erasing HDD"
echo "###############################################################################"
echo
		sgdisk --zap-all /dev/vda
echo
echo "###############################################################################"
echo "Creating EFI Partition"
echo "###############################################################################"
echo
		sgdisk -n 1:2048:+300M -t 1:ef00 /dev/vda
echo
echo "###############################################################################"
echo "Creating Root Partition"
echo "###############################################################################"
echo
		sgdisk -n 2:0:+40G -t 2:8300 /dev/vda
echo
echo "###############################################################################"
echo "Creating Swap Partition"
echo "###############################################################################"
echo
		sgdisk -n 3:0:0 -t 3:8200 /dev/vda
echo
echo "###############################################################################"
echo "Formatting SDA1"
echo "###############################################################################"
echo
		mkfs.fat -F32 /dev/vda1
echo
echo "###############################################################################"
echo "Formatting SDA2"
echo "###############################################################################"
echo
		mkfs.ext4 /dev/vda2
echo
echo "###############################################################################"
echo "Making Swap Partition"
echo "###############################################################################"
echo
		mkswap /dev/vda3
echo
echo "###############################################################################"
echo "Turning swap on"
echo "###############################################################################"
echo
		swapon /dev/vda3
echo
echo "###############################################################################"
echo "Mounting Root Partition"
echo "###############################################################################"
echo
		mount /dev/vda2 /mnt
echo
echo "###############################################################################"
echo "Making Boot folder Structure"
echo "###############################################################################"
echo
		mkdir /mnt/boot
echo
echo "###############################################################################"
echo "Making EFI folder Structure"
echo "###############################################################################"
echo
		mkdir /mnt/boot/efi
echo
echo "###############################################################################"
echo "Mounting Boot"
echo "###############################################################################"
echo
		mount /dev/vda1 /mnt/boot/efi
echo
echo "###############################################################################"
echo "Mirrors"
echo "###############################################################################"
echo
		reflector -l 100 -f 50 -c JP --sort rate --threads 5 --verbose --save /tmp/mirrorlist.new && rankmirrors -n 0 /tmp/mirrorlist.new > /tmp/mirrorlist && sudo cp /tmp/mirrorlist /etc/pacman.d
echo
echo "###############################################################################"
echo "Installing Base packages"
echo "###############################################################################"
echo
		pacstrap /mnt base base-devel linux linux-firmware nano pacman --noconfirm
echo
echo "###############################################################################"
echo "Generating FSTAB"
echo "###############################################################################"
echo
		genfstab -U /mnt >> /mnt/etc/fstab
echo
echo "###############################################################################"
echo "Arch-Chrooting"
echo "###############################################################################"
echo
		arch-chroot /mnt
echo
echo "###############################################################################"
echo "Finished "
echo "###############################################################################"
echo

